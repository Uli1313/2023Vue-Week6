import{_ as x,r as h,o as d,c,b as l,a as e,F as b,i as y,t as m,w as C,h as k,d as L,n as _}from"./index-5_PQs_Pp.js";const w={data(){return{carts:{},isLoading:!1,loadingStatus:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCart(){this.isLoading=!0,this.$http.get("https://ec-course-api.hexschool.io/v2/api/uli01/cart").then(s=>{this.carts=s.data.data}).catch(s=>{alert(s.response.data.message)}).finally(()=>{this.isLoading=!1})},removeCartItem(i){this.loadingStatus.loadingItem=i;const s=`https://ec-course-api.hexschool.io/v2/api/uli01/cart/${i}`;this.$http.delete(s).then(n=>{this.getCart()}).catch(n=>{alert(n.response.data.message)}).finally(()=>{this.loadingStatus.loadingItem=""})},createOrder(){if(!this.carts.carts.length){alert("購物車為空，無法送出訂單");return}this.isLoading=!0;const i="https://ec-course-api.hexschool.io/v2/api/uli01/order",s=this.form;this.$http.post(i,{data:s}).then(n=>{alert(n.data.message),this.$refs.form.resetForm(),this.getCart()}).catch(n=>{alert(n.response.data.message)}).finally(()=>{this.isLoading=!1})}},mounted(){this.getCart()}},F=e("h2",null,"前台購物車",-1),S={class:"row"},I={class:"col-6 mx-auto"},U={class:"table align-middle mb-5"},q=e("thead",null,[e("tr",null,[e("th",{scope:"col"}),e("th",{scope:"col"},"品名"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"單價")])],-1),E={scope:"row"},N=["onClick"],B={key:0,class:"spinner-border spinner-border-sm",role:"status"},M=e("span",{class:"visually-hidden"},"Loading...",-1),O=[M],z={class:"text-end"},D={key:1,class:"text-center"},T=e("td",{colspan:"4"},[e("p",{class:"my-3"},"購物車還沒有任何商品")],-1),j=[T],A=e("th",{scope:"row",colspan:"3",class:"text-end"},"總價",-1),G={class:"text-end"},H=e("h2",{class:"mb-3"},"收件資訊",-1),J={class:"mb-3"},K=e("label",{for:"email",class:"form-label"},"Email",-1),P={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),R={class:"mb-3"},W=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),X={class:"mb-3"},Y=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Z={class:"mb-3"},$=e("label",{for:"message",class:"form-label"},"留言",-1),ee=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1);function se(i,s,n,te,t,p){var f,g;const v=h("VueLoading"),r=h("VField"),u=h("ErrorMessage"),V=h("VForm");return d(),c(b,null,[F,l(v,{active:t.isLoading},null,8,["active"]),e("div",S,[e("div",I,[e("table",U,[q,e("tbody",null,[(g=(f=t.carts)==null?void 0:f.carts)!=null&&g.length?(d(!0),c(b,{key:0},y(t.carts.carts,o=>(d(),c("tr",{key:o.id},[e("th",E,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>p.removeCartItem(o.id)},[t.loadingStatus.loadingItem===o.id?(d(),c("div",B,O)):k("",!0),L(" 移除購物車 ")],8,N)]),e("td",null,m(o.product.title),1),e("td",null,m(o.qty)+" / "+m(o.product.unit),1),e("td",z,m(o.final_total),1)]))),128)):(d(),c("tr",D,j))]),e("tfoot",null,[e("tr",null,[A,e("td",G,m(t.carts.final_total),1)])])]),H,l(V,{ref:"form",class:"text-start",onSubmit:p.createOrder},{default:C(({errors:o})=>[e("div",J,[K,l(r,{id:"email",name:"email",type:"email",class:_(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入信箱",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=a=>t.form.user.email=a)},null,8,["class","modelValue"]),l(u,{name:"email",class:"invalid-feedback"})]),e("div",P,[Q,l(r,{id:"name",name:"姓名",type:"text",class:_(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=a=>t.form.user.name=a)},null,8,["class","modelValue"]),l(u,{name:"姓名",class:"invalid-feedback"})]),e("div",R,[W,l(r,{id:"tel",name:"電話",type:"text",class:_(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:t.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=a=>t.form.user.tel=a)},null,8,["class","modelValue"]),l(u,{name:"電話",class:"invalid-feedback"})]),e("div",X,[Y,l(r,{id:"address",name:"地址",type:"text",class:_(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=a=>t.form.user.address=a)},null,8,["class","modelValue"]),l(u,{name:"地址",class:"invalid-feedback"})]),e("div",Z,[$,l(r,{as:"textarea",id:"message",name:"message",type:"text",class:"form-control",placeholder:"請輸入留言",rows:"10",modelValue:t.form.message,"onUpdate:modelValue":s[4]||(s[4]=a=>t.form.message=a)},null,8,["modelValue"])]),ee]),_:1},8,["onSubmit"])])])],64)}const le=x(w,[["render",se]]);export{le as default};
